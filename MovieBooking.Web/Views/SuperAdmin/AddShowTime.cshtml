@model AddShowTimeViewModel
<h2 class="mt-4">➕ Add ShowTime</h2>

<form method="post" class="card p-4 shadow-sm">
    <div class="row mb-3">
        <div class="col">
            <label>Movie</label>
            <select asp-for="MovieId" class="form-select"
                    asp-items="@(new SelectList(Model.Movies, "MovieId", "Title"))">
                <option value="">-- Select Movie --</option>
            </select>
        </div>
        <div class="col">
            <label>Language</label>
            <select asp-for="LanguageId" class="form-select"
                    asp-items="@(new SelectList(Model.Languages, "LanguageId", "Name"))">
                <option value="">-- Select Language --</option>
            </select>

        </div>
    </div>

    <div class="row mb-3">
        <div class="col">
            <label>Theatre</label>
            <select asp-for="TheatreId" class="form-select" id="theatreDropdown"
                    asp-items="@(new SelectList(Model.Theatres, "TheatreId", "Name"))">
                <option value="">-- Select Theatre --</option>
            </select>
        </div>

        <div class="col">
            <label>Screen</label>
            <select asp-for="ScreenId" class="form-select" id="screenDropdown" disabled>
                <option value="">-- Select Screen --</option>
            </select>
        </div>
    </div>


    <div class="row">
        <div class="col">
            <label>Start Time</label>
            <input asp-for="StartTime" type="datetime-local" class="form-control" />
        </div>
        <div class="col">
            <label>Base Price</label>
            <input asp-for="BasePrice" class="form-control" />
        </div>
    </div>

    <button class="btn btn-success mt-4">Save ShowTime</button>
</form>
@section Scripts {
<script>
document.addEventListener("DOMContentLoaded", function () {

    const theatreDropdown = document.getElementById("theatreDropdown");
    const screenDropdown = document.getElementById("screenDropdown");

    theatreDropdown.addEventListener("change", async function () {

        const theatreId = this.value;

        // Reset screen dropdown
        screenDropdown.innerHTML = '<option value="">-- Select Screen --</option>';
        screenDropdown.disabled = true;

        if (!theatreId)
            return;

        try {
            const response = await fetch(`/SuperAdmin/GetScreensByTheatre?theatreId=${theatreId}`);

            if (!response.ok)
                throw new Error("Failed to load screens");

            const screens = await response.json();

            if (screens.length === 0)
                return;

            screens.forEach(screen => {
                const option = document.createElement("option");
                option.value = screen.screenId;
                option.text = screen.screenName;
                screenDropdown.appendChild(option);
            });

            screenDropdown.disabled = false;

        } catch (err) {
            console.error(err);
            alert("Unable to load screens for selected theatre.");
        }
    });
});
</script>
}
